@model EasyGames.Models.Product
<h2>@Model.Name</h2>
<p>@Model.Category</p><p>$@Model.Price</p>
<form method="post" asp-controller="Cart" asp-action="Add" class="add-form">
    <input type="hidden" name="productId" value="@Model.Id" />
    <input type="number" name="qty" value="1" min="1" />
    @Html.AntiForgeryToken()
    <button class="btn btn-primary">Add to cart</button>
</form>
@section Scripts {
    <script>
        document.querySelectorAll('.add-form').forEach(f=>{
          f.addEventListener('submit', async e=>{
            e.preventDefault();
            const r=await fetch(f.action,{method:'POST',body:new FormData(f)});
            const j=await r.json(); if(j.ok){ const b=document.getElementById('cart-count'); if(b)b.innerText=j.count; }
          });
        });
    </script>
}
